$(document).ready((function(){const e=window.siwaneGlobalConfig||{},n=new URLSearchParams(window.location.search),t=n.get("mode"),i="https://secure-player.mnaht00.workers.dev";if("watch"===t){const t=n.get("sheet"),s=n.get("ep"),a=n.get("movie");if(t&&e.GAS_URL){const n={GAS_URL:e.GAS_URL,COUNTDOWN:e.COUNTDOWN||10,SHEET:decodeURIComponent(t),TYPE:a?"movie":"series",ID:a?decodeURIComponent(a):s};n.ID&&function(e){const n=$(".post-body, .entry-content, #post-body").first();if(0===n.length)return;let t="movie"===e.TYPE?e.ID:`${e.SHEET} - Ø§Ù„Ø­Ù„Ù‚Ø© ${e.ID}`;document.title=`Ù…Ø´Ø§Ù‡Ø¯Ø© ${t}`;const s=$(`\n            <div class="siwane-container">\n                <header class="siwane-header"><h1>${t}</h1></header>\n                <div class="siwane-server-container">\n                    <h2>Ø§Ø®ØªØ± Ø³ÙŠØ±ÙØ± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</h2>\n                    <div id="siwane-servers-grid" class="siwane-servers-grid loading-state"><p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª...</p></div>\n                </div>\n            </div>\n        `),a=$('\n            <div class="siwane-container">\n                <div class="siwane-video-container">\n                    <h2>Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶</h2>\n                    <div id="siwane-countdown-display">\n                        <div class="siwane-particles-container" id="siwane-particles-container"></div>\n                        <div id="siwane-countdown-text">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø³ÙŠØ±ÙØ± Ù„Ù„Ø¨Ø¯Ø¡</div>\n                        <div id="siwane-countdown"></div>\n                    </div>\n                    <iframe id="siwane-video-frame" allowfullscreen sandbox="allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation"></iframe>\n                </div>\n            </div>\n        ');n.prepend(s),n.append(a),function(){const e=$(".siwane-particles-container");e.empty();for(let n=0;n<30;n++){const n=$('<div class="siwane-particle"></div>');n.css({left:100*Math.random()+"%",top:100*Math.random()+"%",animationDuration:4*Math.random()+3+"s"}),e.append(n)}}(),function(e){const n=$("#siwane-servers-grid");let t=`contentSheetName=${encodeURIComponent(e.SHEET)}`;"movie"===e.TYPE?t+=`&movieTitle=${encodeURIComponent(e.ID)}`:t+=`&episodeNumber=${e.ID}`;$.ajax({url:`${e.GAS_URL}?${t}`,type:"GET",dataType:"json",success:function(t){n.removeClass("loading-state").empty(),t.forEach((t=>{const s=$(`<div class="siwane-server-btn" data-id="${t.id}"><span>${t.icon}</span> <span>${t.title}</span></div>`);s.click((function(){$(".siwane-server-btn").removeClass("active"),$(this).addClass("active"),$("html, body").animate({scrollTop:$(".siwane-video-container").offset().top-20},800),function(e,n){$("#siwane-video-frame").hide(),$("#siwane-countdown-display").css("display","flex"),$("#siwane-countdown-text").text("Ø¬Ø§Ø±ÙŠ ØªØ£Ù…ÙŠÙ† Ø§Ù„Ø§ØªØµØ§Ù„..."),$.ajax({url:`${i}/get-secure-player`,data:{sheet:n.SHEET,id:e},type:"GET",dataType:"json",success:function(e){if(e.realUrl){const t=btoa(e.realUrl).split("").reverse().join(""),i=new Blob([`\n                        <!DOCTYPE html>\n                        <html>\n                        <head>\n                            <meta charset="UTF-8">\n                            <style>\n                                body { margin:0; padding:0; overflow:hidden; background:#000; color:#fff; display:flex; align-items:center; justify-content:center; height:100vh; text-align:center; font-family:sans-serif; }\n                                .security-msg { padding:20px; border:2px solid #ff4444; border-radius:10px; background:rgba(255,0,0,0.1); direction:rtl; }\n                                h1 { font-size:22px; color:#ff4444; margin-bottom:10px; }\n                                p { font-size:16px; margin:0; }\n                            </style>\n                        </head>\n                        <body>\n                            <div id="c" style="width:100%;height:100%;"></div>\n                            <script>\n                                (function() {\n                                    var allowed = "www.athar.news";\n                                    var host = "";\n                                    try { host = window.parent.location.hostname; } catch(e) { host = "blocked"; }\n                                    var container = document.getElementById("c");\n                                    \n                                    if (host !== allowed && host !== "athar.news") {\n                                        container.innerHTML = '<div class="security-msg"><h1>Ø£ÙˆØ¨Ø³ Ø¬Ù…Ø§Ù„ Ø§ÙƒØªØ´ÙÙƒ Ø§ÙŠÙ‡Ø§ Ø§Ù„Ù…ØªØ·ÙÙ„!</h1><p>Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø­Ù„Ù‚Ø© ÙˆÙ„Ø§ ØªØ³Ø±Ù‚ Ù…Ø¬Ù‡ÙˆØ¯Ù†Ø§ ğŸ˜Š</p></div>';\n                                    } else {\n                                        // ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ± Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„ ÙÙ‚Ø·\n                                        var key = "${t}";\n                                        var raw = atob(key.split('').reverse().join(''));\n                                        container.innerHTML = '<iframe src="' + raw + '" style="width:100%;height:100%;border:none;" allowfullscreen></iframe>';\n                                    }\n                                })();\n                            <\/script>\n                        </body>\n                        </html>\n                    `],{type:"text/html"});!function(e,n){let t=n;const i=$("#siwane-countdown"),s=$("#siwane-countdown-text");s.text("Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...");const a=setInterval((()=>{i.text(t),t--,t<0&&(clearInterval(a),i.text(""),s.text("Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ù…ØªØ¹Ø©!"),setTimeout((()=>{$("#siwane-countdown-display").hide();const n=$("#siwane-video-frame").attr("src");n&&n.startsWith("blob:")&&URL.revokeObjectURL(n),$("#siwane-video-frame").attr("src",e).show()}),1e3))}),1e3)}(URL.createObjectURL(i),n.COUNTDOWN)}else $("#siwane-countdown-text").text("Ø®Ø·Ø£: "+(e.error||"ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø·"))},error:function(){$("#siwane-countdown-text").text("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„ÙˆØ±ÙƒØ±.")}})}($(this).data("id"),e)})),n.append(s)}))}})}(e)}(n)}}else{const n=$("#siwane-lobby");if(n.length>0&&e.GAS_URL){const t=n.data("sheet"),i=n.data("movie");t&&(i?function(e,n,t){let i=`<div class="siwane-episodes-container"><h2>${n}</h2><div class="siwane-episodes-grid" style="grid-template-columns: 1fr;"><div class="siwane-episode-btn" onclick="siwaneRedirect('${e}', '${n}', 'movie')">Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¢Ù†</div></div></div>`;window.siwaneRedirect=(e,n,t)=>s(e,n,t),t.html(i)}(t,i,n):function(e,n,t){t.html('<p class="note">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø­Ù„Ù‚Ø§Øª...</p>'),$.ajax({url:`${e}?contentSheetName=${encodeURIComponent(n)}&action=getEpisodes`,type:"GET",dataType:"json",success:function(e){if(e.episodes&&e.episodes.length>0){let i=`<div class="siwane-episodes-container"><h2>Ø­Ù„Ù‚Ø§Øª ${n}</h2><div class="siwane-episodes-grid">`;e.episodes.forEach((e=>{null===e||"null"===e||isNaN(e)||(i+=`<div class="siwane-episode-btn" onclick="siwaneRedirect('${n}', '${e}', 'series')">Ø§Ù„Ø­Ù„Ù‚Ø© ${e}</div>`)})),i+="</div></div>",window.siwaneRedirect=(e,n,t)=>s(e,n,t),t.html(i)}}})}(e.GAS_URL,t,n))}}async function s(e,n,t){try{let i=await fetch("/feeds/posts/summary?alt=json&max-results=150"),s=(await i.json()).feed.entry;if(s&&s.length>0){let i=s[Math.floor(Math.random()*s.length)].link.find((e=>"alternate"===e.rel)).href,a=i.includes("?")?"&":"?",o="movie"===t?`&movie=${encodeURIComponent(n)}`:`&ep=${n}`;window.location.href=`${i}${a}mode=watch&sheet=${encodeURIComponent(e)}${o}`}}catch(e){alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„.")}}}));
