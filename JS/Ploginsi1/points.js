import{initializeApp as e}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";import{getAuth as o,onAuthStateChanged as t,signOut as n}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";import{getFirestore as a,doc as l,getDoc as i,updateDoc as r,runTransaction as s,serverTimestamp as c,Timestamp as d}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";window.adsbygoogle=window.adsbygoogle||[],window.adsbygoogle.push=function(){try{arguments[0]&&"object"==typeof arguments[0]&&console.log("Google Ads suppressed to prevent errors")}catch(e){console.log("Adsbygoogle error handled silently")}};function p(e){const o=document.createElement("div");o.className="overlay";const t=document.createElement("div");t.className="notification-error",t.innerHTML="key"===e?'\n      <p>Ø®Ø·Ø£: Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­! ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªÙƒÙˆÙŠÙ†.</p>\n      <a href="mailto:support@siwane.xyz?subject=Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„" class="support-link">Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø¯Ø¹Ù…</a>\n    ':"naming"===e?'\n      <p>Ø®Ø·Ø£: Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…! ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¯Ø¹Ù….</p>\n      <a href="mailto:support@siwane.xyz?subject=Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚" class="support-link">Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø¯Ø¹Ù…</a>\n    ':'\n        <p>Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹! ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¯Ø¹Ù….</p>\n        <a href="mailto:support@siwane.xyz?subject=Ø®Ø·Ø£ Ø¹Ø§Ù…" class="support-link">Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø¯Ø¹Ù…</a>\n      ',document.body.appendChild(o),document.body.appendChild(t)}function u(){if(document.querySelector(".copy-warning"))return;const e=document.createElement("div");e.className="copy-warning",e.innerHTML='\n    <div class="warning-overlay"></div>\n    <div class="warning-content">\n      <h3>ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù†Ø³Ø® Ø§Ù„Ù…Ø­ØªÙˆÙ‰!</h3>\n      <p>Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± Ù…Ø­ÙÙˆØ¸Ø©</p>\n    </div>\n  ',document.body.appendChild(e),setTimeout((()=>{e.remove()}),3e3)}window.self!==window.top&&(window.top.location.href=window.self.location.href);(()=>{const e=document.createElement("style");e.textContent="\n    body {\n      -webkit-user-select: none !important;\n      -moz-user-select: none !important;\n      -ms-user-select: none !important;\n      user-select: none !important;\n    }\n    .copy-warning {\n      position: fixed; top: 0; left: 0;\n      width: 100%; height: 100%; z-index: 9999;\n      display: flex; align-items: center; justify-content: center;\n    }\n    .warning-overlay {\n      position: absolute; width: 100%; height: 100%;\n      background: rgba(0,0,0,0.7);\n    }\n    .warning-content {\n      position: relative; background: #f8d7da; padding: 30px;\n      border-radius: 10px; text-align: center; max-width: 80%;\n      box-shadow: 0 0 20px rgba(0,0,0,0.5); z-index: 10000;\n    }\n    .warning-content h3 { color: #721c24; margin-bottom: 15px; }\n    .overlay {\n      position: fixed; top: 0; left: 0;\n      width: 100%; height: 100%;\n      background: rgba(255, 255, 255, 0.7);\n      z-index: 999; backdrop-filter: blur(5px);\n    }\n    .notification-error {\n      background-color: #f8d7da; color: #721c24; padding: 20px;\n      text-align: center; border-radius: 10px;\n      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);\n      font-weight: bold; font-size: 18px;\n      position: fixed; top: 50%; left: 50%;\n      transform: translate(-50%, -50%);\n      animation: slideIn 0.5s ease-in-out;\n      z-index: 1000; width: 80%; max-width: 500px;\n    }\n    .support-link {\n      display: block; margin-top: 15px; padding: 10px; \n      background-color: #25d366; color: white; text-decoration: none;\n      font-weight: bold; border-radius: 5px; text-align: center;\n    }\n    .support-link:hover { background-color: #128c7e; }\n    @keyframes slideIn {\n      from { opacity: 0; transform: translate(-50%, -60%); }\n      to { opacity: 1; transform: translate(-50%, -50%); }\n    }\n    .badge-pop-out { animation: pop-out-animation 0.25s ease-in forwards; }\n    .badge-pop-in { animation: pop-in-animation 0.25s ease-out forwards; }\n    @keyframes pop-out-animation {\n        0% { transform: scale(1); opacity: 1; }\n        100% { transform: scale(0.5); opacity: 0; }\n    }\n    @keyframes pop-in-animation {\n        0% { transform: scale(0.5); opacity: 0; }\n        100% { transform: scale(1); opacity: 1; }\n    }\n  ",document.head.appendChild(e)})(),document.addEventListener("contextmenu",(e=>(e.preventDefault(),u(),!1))),document.addEventListener("copy",(e=>(e.preventDefault(),u(),!1))),document.addEventListener("dragstart",(e=>(e.preventDefault(),u(),!1))),document.addEventListener("selectstart",(e=>(e.preventDefault(),u(),!1))),document.addEventListener("keydown",(e=>e.ctrlKey&&e.shiftKey&&["I","J","C"].includes(e.key.toUpperCase())||"F12"===e.key||e.ctrlKey&&"U"===e.key.toUpperCase()?(e.preventDefault(),u(),!1):void 0)),function(){if("undefined"==typeof encryptedBase64||!encryptedBase64.activationCode||!encryptedBase64.customSettings)return console.error("encryptedBase64 object not found or incomplete."),void p("key");const u=atob("UmF3YW4wNUAqIyQ="),g=function(e,o){try{const t=atob(e);return CryptoJS.AES.decrypt(t,o).toString(CryptoJS.enc.Utf8)}catch(e){return console.error("Decryption failed:",e),p("key"),null}}(encryptedBase64.activationCode,u);if(g){window.location.hostname.replace(/^www\./,"")===g.replace(/^www\./,"")?function(p){console.log("Script start - inside protectedCode.");const u='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.0" stroke-linecap="round" stroke-linejoin="round"><path d="M16.7 18.98H7.30002C6.88002 18.98 6.41002 18.65 6.27002 18.25L2.13002 6.66999C1.54002 5.00999 2.23002 4.49999 3.65002 5.51999L7.55002 8.30999C8.20002 8.75999 8.94002 8.52999 9.22002 7.79999L10.98 3.10999C11.54 1.60999 12.47 1.60999 13.03 3.10999L14.79 7.79999C15.07 8.52999 15.81 8.75999 16.45 8.30999L20.11 5.69999C21.67 4.57999 22.42 5.14999 21.78 6.95999L17.74 18.27C17.59 18.65 17.12 18.98 16.7 18.98Z"></path><path d="M6.5 22H17.5"></path><path d="M9.5 14H14.5"></path></svg>',g='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.0" stroke-linecap="round" stroke-linejoin="round"><path d="M10.49 2.23006L5.50003 4.11006C4.35003 4.54006 3.41003 5.90006 3.41003 7.12006V14.5501C3.41003 15.7301 4.19003 17.2801 5.14003 17.9901L9.44003 21.2001C10.85 22.2601 13.17 22.2601 14.58 21.2001L18.88 17.9901C19.83 17.2801 20.61 15.7301 20.61 14.5501V7.12006C20.61 5.89006 19.67 4.53006 18.52 4.10006L13.53 2.23006C12.68 1.92006 11.32 1.92006 10.49 2.23006Z"></path><path d="M9.05005 11.8701L10.66 13.4801L14.96 9.18005"></path></svg>',m='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.0" stroke-linecap="round" stroke-linejoin="round"><path d="M16.29 2.15002H7.69995C5.99995 2.15002 5.24995 3.00002 4.78995 4.04002L2.22995 9.80002C1.76995 10.84 2.01995 12.39 2.78995 13.23L9.64995 20.77C10.95 22.19 13.07 22.19 14.36 20.77L21.21 13.22C21.98 12.37 22.23 10.83 21.76 9.79002L19.2 4.03002C18.74 3.00002 17.99 2.15002 16.29 2.15002Z"></path><path d="M3.5 8H20.5"></path></svg>',f='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.0" stroke-linecap="round" stroke-linejoin="round"><path d="M13.73 3.51001L15.49 7.03001C15.73 7.52002 16.37 7.99001 16.91 8.08001L20.1 8.61001C22.14 8.95001 22.62 10.43 21.15 11.89L18.67 14.37C18.25 14.79 18.02 15.6 18.15 16.18L18.86 19.25C19.42 21.68 18.13 22.62 15.98 21.35L12.99 19.58C12.45 19.26 11.56 19.26 11.01 19.58L8.01997 21.35C5.87997 22.62 4.57997 21.67 5.13997 19.25L5.84997 16.18C5.97997 15.6 5.74997 14.79 5.32997 14.37L2.84997 11.89C1.38997 10.43 1.85997 8.95001 3.89997 8.61001L7.08997 8.08001C7.61997 7.99001 8.25997 7.52002 8.49997 7.03001L10.26 3.51001C11.22 1.60001 12.78 1.60001 13.73 3.51001Z"></path></svg>',w='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.0" stroke-linecap="round" stroke-linejoin="round"><path d="M12 12C14.7614 12 17 9.76142 17 7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7C7 9.76142 9.23858 12 12 12Z"></path><path d="M20.5899 22C20.5899 18.13 16.7399 15 11.9999 15C7.25991 15 3.40991 18.13 3.40991 22"></path></svg>',h='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.0" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line></svg>';let y=null;const C={firebaseConfig:p.firebase,offerwall:{pageUrl:p.offerwallPageUrl,localStorageKeys:{opened:"offerwallOpened",openTime:"offerwallOpenTime",interaction:"offerwallInteraction"},requiredDurationMillis:p.offerwallRequiredDurationMillis,pointsToAward:p.offerwallPointsToAward},points:{perDayExchange:p.pointsPerDayExchange,perMonthExchange:p.pointsPerMonthExchange,earnCooldownMillis:p.pointsEarnCooldownMillis},giftCode:{gasUrl:p.gasGiftCodeUrl}};window.onerror=function(e,o,t,n,a){return console.error("Global Error Caught:",{message:e,source:o,lineno:t,colno:n,error:a}),e&&e.includes("adsbygoogle")?(console.log("Google Ads error suppressed"),!0):(setTimeout((()=>{V("Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: "+(a?a.message:e)),document.querySelector("#astat p")&&(document.querySelector("#astat p").textContent="Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„."),ee()}),10),!0)},window.addEventListener("unhandledrejection",(function(e){if(console.error("Unhandled Promise Rejection:",e.reason),e.reason&&e.reason.message&&e.reason.message.includes("adsbygoogle"))return console.log("Google Ads promise error suppressed"),void e.preventDefault();setTimeout((()=>{V("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†Ø©: "+(e.reason?e.reason.message||e.reason:"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ")),document.querySelector("#astat p")&&(document.querySelector("#astat p").textContent="Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„."),ee()}),10),e.preventDefault()}));const v=e(C.firebaseConfig),b=o(v),E=a(v),k=document.querySelector("#astat p"),x=document.getElementById("pic"),L=document.getElementById("lbtn"),P=document.getElementById("pge-pts"),S=document.getElementById("pts-curr"),T=document.getElementById("prem-stat"),A=document.getElementById("prem-exp"),D=document.getElementById("btn-earn"),U=document.getElementById("cd-timer"),$=document.getElementById("btn-exch1"),I=document.getElementById("btn-exch30"),O=document.querySelector("#msg .err"),M=document.querySelector("#msg .suc"),B=document.getElementById("gift-code"),N=document.getElementById("btn-redeem"),F=document.getElementById("gift-result"),_=document.getElementById("account-type-badge"),j=(document.getElementById("earn-section"),document.getElementById("points-actions-container")),R=document.getElementById("permanent-access-notice"),q=C.points.perDayExchange,z=C.points.perMonthExchange,H=C.points.earnCooldownMillis;let G=null,K=null;function V(e){console.error("App Error:",e),O&&(O.textContent=e,O.style.display="block",M&&(M.style.display="none")),setTimeout(J,2e4)}function W(e){console.log("App Success:",e),M&&(M.textContent=e,M.style.display="block",O&&(O.style.display="none")),setTimeout(J,2e4)}function J(){O&&(O.style.display="none"),M&&(M.style.display="none")}function Z(e,o){F&&(F.textContent=o,F.className="gift-result",e?F.classList.add("gift-success"):F.classList.add("gift-error"),F.style.display="block",setTimeout((()=>{F.style.display="none",F.textContent=""}),5e3))}function Q(e){e<0&&(e=0);const o=Math.ceil(e/1e3),t=Math.floor(o/60),n=Math.floor(o%60);return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}function Y(e){if(null===e)return"var(--msg-succ-col, green)";let o=null;if(e instanceof d?o=e.toDate():e&&"number"==typeof e.seconds&&(o=new Date(1e3*e.seconds)),!o)return"var(--msg-err-col, red)";const t=Date.now(),n=o.getTime(),a=Math.ceil((n-t)/864e5);return a<=0?"var(--expiry-red-col, darkred)":a<=14?"var(--expiry-warning-col, orange)":a<=30?"var(--expiry-mild-col, gold)":"var(--expiry-safe-col, green)"}function X(){if(console.log("updateEarnButtonState - start"),!D||!U)return void console.warn("Earn point button or cooldown timer span element not found!");if(!G||!K||!K.lastPointEarnedTimestamp)return D.disabled=!1,D.textContent="Ø£ÙƒØ³Ø¨ Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ù†",U.textContent="",U.style.display="none",D._cooldownTimeout&&(clearTimeout(D._cooldownTimeout),D._cooldownTimeout=null),void console.log("updateEarnButtonState - end (user not logged in, data not ready or no timestamp)");const e=K.lastPointEarnedTimestamp,o=Date.now();let t=0;e?e instanceof d?t=e.toDate().getTime():"number"==typeof e?t=e:"object"==typeof e&&void 0!==e.seconds?t=1e3*e.seconds+(e.nanoseconds||0)/1e6:(console.warn("lastPointEarnedTimestamp has an unrecognized format:",e),t=0):t=0;const n=o-t;if(n>=H)D.disabled=!1,D.textContent="Ø£ÙƒØ³Ø¨ Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ù†",U.textContent="",U.style.display="none",D._cooldownTimeout&&(clearTimeout(D._cooldownTimeout),D._cooldownTimeout=null),console.log("updateEarnButtonState - end (can earn)");else{D.disabled=!0;const e=H-n,o=Q(e);D.textContent="Ø§Ù†ØªØ¸Ø± Ù„ÙƒØ³Ø¨ Ù†Ù‚Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©",U.textContent=`Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${o}`,U.style.display="block",D._cooldownTimeout&&clearTimeout(D._cooldownTimeout);const t=e>1e3?e%1e3||1e3:e>0?e:50;D._cooldownTimeout=setTimeout(X,t),console.log(`updateEarnButtonState - end (cooldown active: ${o} remaining, next update in ${t}ms)`)}}function ee(){console.log("Enabling earn and exchange buttons by refreshing UI."),G?ae():le()}function oe(){console.log("Disabling earn and exchange buttons (temporarily)."),D&&(D.disabled=!0),$&&($.disabled=!0),I&&(I.disabled=!0),N&&(N.disabled=!0)}function te(){const e=K&&null!=K.points?K.points:0;let o=!1;if(K){const e=p.ownerAdminEmail||"admin@siwane.xyz",t=G&&G.email&&G.email.toLowerCase()===e.toLowerCase()||!0===K.isAdmin;let n=!0===K.isVip;void 0!==K.isVip||"vipp"!==K.accountType&&"vipp"!==K.adStatus||(n=!0);const a=null===K.premiumExpiry;o=t||n||a}const t="Ø­Ø³Ø§Ø¨Ùƒ Ø¯Ø§Ø¦Ù… Ø¨Ø§Ù„ÙØ¹Ù„ ÙˆÙ„Ø§ ÙŠØ­ØªØ§Ø¬ Ù„Ù„ØªØ±Ù‚ÙŠØ©.";$&&($.disabled=o||e<q,$.title=o?t:""),I&&(I.disabled=o||e<z,I.title=o?t:"")}function ne(){N&&(N.disabled=!G)}async function ae(){if(console.log("fetchUserData - start"),!G)return console.log("fetchUserData - No current user."),K=null,le(),void console.log("fetchUserData - end (no user)");const e=l(E,"users",G.uid);try{console.log(`Attempting to get doc for user ${G.uid}`);const o=await i(e);o.exists()?(console.log("User doc exists. Getting data."),K=o.data(),K.points=K.points??0,K.totalExchanges=K.totalExchanges??0,K.totalPointsEarned=K.totalPointsEarned??0,K.accountType=K.accountType??K.accountStatus??"normal",K.email=G.email,K.adFreeExpiry=K.adFreeExpiry??new d(0,0),console.log("User data fetched:",K)):(console.warn("fetchUserData - User document does not exist!"),K=null,V("ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…. Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø£Ùˆ Ø²ÙŠØ§Ø±Ø© Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ Ø£ÙˆÙ„Ø§."))}catch(e){console.error("fetchUserData - Error fetching user data:",e),V("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: "+e.message),K=null}le(),console.log("fetchUserData - end")}function le(){if(console.log("updateUI - start"),y&&(clearInterval(y),y=null),G){k&&(k.textContent=`Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ÙŠØ§ ${K?.fullName||G.email||"Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"}`),L&&(L.style.display="inline-block");const e=G.photoURL;x&&(x.src=e||p.defaultUserPhotoURL||"https://cdn-icons-png.flaticon.com/512/3135/3135715.png",x.style.display="inline-block")}else k&&(k.textContent="Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„."),L&&(L.style.display="none"),x&&(x.src=p.defaultUserPhotoURL||"https://cdn-icons-png.flaticon.com/512/3135/3135715.png",x.style.display="inline-block");if(!G||!K)return console.log("updateUI - No user or data. Hiding profile view."),P&&(P.style.display="none"),S&&(S.textContent="..."),T&&(T.textContent="..."),A&&(A.textContent="",A.style=""),D&&(D.disabled=!0),U&&(U.textContent="",U.style.display="none"),_&&(_.style.display="none",_.innerHTML=""),x&&(x.style.borderColor="var(--page-bg, #fff)"),j&&(j.style.display="none"),R&&(R.style.display="none"),te(),ne(),void console.log("updateUI - end (no user/data)");console.log("updateUI - User and data available. Updating profile view."),P&&(P.style.display="block"),S&&(S.textContent=K.points??0);const e=p.ownerAdminEmail||"admin@siwane.xyz",o=G&&G.email&&G.email.toLowerCase()===e.toLowerCase(),t=new Date;let n=!0===K.isVip;void 0!==K.isVip||"vipp"!==K.accountType&&"vipp"!==K.adStatus||(n=!0);const a=o||!0===K.isAdmin,l=K.premiumExpiry;let i=null;l instanceof d?i=l.toDate():l&&"number"==typeof l.seconds&&(i=new Date(1e3*l.seconds));const r=null===l,s=i&&i.getTime()>t.getTime(),c="premium"===K.accountType&&(s||r),C=K.adFreeExpiry;let v=null;C instanceof d?v=C.toDate():C&&"number"==typeof C.seconds&&(v=new Date(1e3*C.seconds));const b=null===C,E=v&&v.getTime()>t.getTime(),$=b||E;let I="Ø­Ø³Ø§Ø¨ Ø¹Ø§Ø¯ÙŠ",O="status-normal",M="Ù‚Ù… Ø¨ØªØ­ÙˆÙŠÙ„ Ù†Ù‚Ø§Ø·Ùƒ Ù„Ù„ØªØ±Ù‚ÙŠØ©!",B="var(--prof-lbl-col)";o?(I="Ù…Ø§Ù„Ùƒ Ø§Ù„Ù†Ø¸Ø§Ù…",O="status-admin",M="(ÙˆØµÙˆÙ„ Ø¯Ø§Ø¦Ù…)",B="var(--acct-owner-col)"):a?(I="Ø­Ø³Ø§Ø¨ Ù…Ø´Ø±Ù",O="status-admin",M="(ÙˆØµÙˆÙ„ Ø¯Ø§Ø¦Ù…)",B="var(--acct-admin-col)"):n?(I="Ø¹Ø¶ÙˆÙŠØ© VIP",O="status-vip",M="(ÙˆØµÙˆÙ„ Ø¯Ø§Ø¦Ù…)",B="var(--acct-vip-col)"):c&&r?(I="Ø§Ø­ØªØ±Ø§ÙÙŠ (Ø¯Ø§Ø¦Ù…)",O="status-premium",M="(ÙˆØµÙˆÙ„ Ø¯Ø§Ø¦Ù…)",B="var(--acct-premium-col)"):c&&s?(I="Ø§Ø­ØªØ±Ø§ÙÙŠ (Ù…Ø¤Ù‚Øª)",O="status-premium",M=`ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ: ${i.toLocaleDateString("ar-MA")}`,B=Y(l)):b?(I="Ù…Ø¹ÙÙ‰ Ù…Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª (Ø¯Ø§Ø¦Ù…)",O="status-ad-free",M="(ÙˆØµÙˆÙ„ Ø¯Ø§Ø¦Ù…)",B="var(--msg-succ-col)"):E?(I="Ù…Ø¹ÙÙ‰ Ù…Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª (Ù…Ø¤Ù‚Øª)",O="status-ad-free",M=`ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ: ${v.toLocaleDateString("ar-MA")}`,B=Y(C)):c&&!s&&(I="Ø§Ø­ØªØ±Ø§ÙÙŠ (Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©)",O="status-expired",M=`Ø§Ù†ØªÙ‡Ù‰ ÙÙŠ: ${i.toLocaleDateString("ar-MA")}`,B="var(--msg-err-col)"),T&&(T.textContent=I,T.className=`status-text ${O}`),A&&(A.textContent=M,A.style.color=B,A.style.fontStyle=M?"italic":"",A.style.fontSize=M?"0.9em":"",A.style.textAlign=M?"center":"end");const N=a;let F="",q="var(--page-bg)";_&&(_.style.display="flex",_.className="",o?(F=u,_.classList.add("badge-owner"),q="var(--acct-owner-col, darkred)"):a&&!o?(F=g,_.classList.add("badge-admin"),q="var(--acct-admin-col, blue)"):n?(F=m,_.classList.add("badge-vipp"),q="var(--acct-vip-col, purple)"):c?(F=f,_.classList.add("badge-premium"),q="var(--acct-premium-col, gold)"):$?(F=h,_.classList.add("badge-ad-free"),q="var(--msg-succ-col, green)"):(F=w,_.classList.add("badge-normal"),q="#6c757d"),_.innerHTML=F),x&&(x.style.borderColor=q);if(j&&R)if(a||n||r){j.style.display="none";let e="<strong>Ù„Ø¯ÙŠÙƒ ÙˆØµÙˆÙ„ Ø¯Ø§Ø¦Ù…!</strong>";e+="Ø¨Ù…Ø§ Ø£Ù† Ø¹Ø¶ÙˆÙŠØªÙƒ Ù…ÙØ¹Ù„Ø© Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù…ØŒ ÙØ£Ù†Øª Ù„Ø³Øª Ø¨Ø­Ø§Ø¬Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø£Ùˆ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰.";const o=K.points??0;o>0&&(e+=`<br><br><b>Ù…Ù„Ø§Ø­Ø¸Ø©:</b> Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© ÙÙŠ Ø±ØµÙŠØ¯Ùƒ (${o} Ù†Ù‚Ø§Ø·) Ù‡ÙŠ Ø±ØµÙŠØ¯ Ù‚Ù…Øª Ø¨Ø¬Ù…Ø¹Ù‡ <b>Ù‚Ø¨Ù„</b> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© Ø§Ù„Ø¯Ø§Ø¦Ù…Ø©.`),R.innerHTML=e,R.style.display="block"}else j.style.display="block",R.style.display="none";if(!N&&(n||c||$)&&_){let e=null;n?e={svg:m,className:"badge-vipp",borderColor:"var(--acct-vip-col, purple)"}:c&&(e={svg:f,className:"badge-premium",borderColor:"var(--acct-premium-col, gold)"});const o={svg:h,className:"badge-ad-free",borderColor:"var(--msg-succ-col, green)"};let t=e,a=o;if(!t&&$?(t=o,a=null):t&&!$?a=null:t||$||(a=null),t&&(_.innerHTML=t.svg,_.className=t.className,x&&(x.style.borderColor=t.borderColor)),t&&a){let e=!0;y=setInterval((()=>{_?(_.classList.remove("badge-pop-in"),_.classList.add("badge-pop-out"),setTimeout((()=>{if(!_)return;const o=e?a:t,n=e?a.borderColor:t.borderColor;_.innerHTML=o.svg,_.className=o.className,x&&(x.style.borderColor=n),e=!e,_.classList.add("badge-pop-in")}),250)):clearInterval(y)}),5e3)}}X(),te(),ne(),console.log("updateUI - end")}async function ie(){console.log("checkOfferwallCompletionAndAwardPoint - Start checking for offerwall completion.");const e=C.offerwall.localStorageKeys,o=localStorage.getItem(e.opened),t=localStorage.getItem(e.openTime),n=localStorage.getItem(e.interaction);console.log("checkOfferwallCompletionAndAwardPoint - Values read from localStorage:",{opened:o,openTime:t,interaction:n});let a=!1,l="";if("true"===o)if(console.log("checkOfferwallCompletionAndAwardPoint - 'offerwallOpened' was true. Proceeding with detailed checks."),G&&K){const e=parseInt(t),o=Date.now()-e,n=C.offerwall.requiredDurationMillis;console.log(`checkOfferwallCompletionAndAwardPoint - User/Data available. Duration check: ${o}ms >= ${n}ms ? ${o>=n}`),isNaN(e)?(console.warn("checkOfferwallCompletionAndAwardPoint - Parsed offerwallOpenTime is NaN. Conditions NOT met."),l="Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‚Øª ÙØªØ­ Ø§Ù„Ø¹Ø±Ø¶ ØºÙŠØ± ØµØ§Ù„Ø­Ø©."):o>=n?(a=!0,console.log("checkOfferwallCompletionAndAwardPoint - ğŸ‰ Conditions met (Duration OK)! Flag 'shouldAward' set to true.")):(console.log("checkOfferwallCompletionAndAwardPoint - âŒ Conditions NOT met (Duration too short). Flag 'shouldAward' remains false."),l=`Ù„Ù… ØªÙ‚Ø¶ ÙˆÙ‚ØªØ§ ÙƒØ§ÙÙŠØ§ (Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${n/1e3} Ø«Ø§Ù†ÙŠØ©ØŒ Ù‚Ø¶ÙŠØª: ${Math.round(o/1e3)} Ø«Ø§Ù†ÙŠØ©).`,console.log("checkOfferwallCompletionAndAwardPoint - âŒ Conditions NOT met (Duration too short). Reason:",l))}else console.warn("checkOfferwallCompletionAndAwardPoint - Offerwall data found in localStorage, but no logged-in user or user data. Cannot process point award fully yet."),l="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©.";else console.log("checkOfferwallCompletionAndAwardPoint - 'offerwallOpened' is not 'true'. No offerwall completion check needed (based on localStorage flag).");console.log("checkOfferwallCompletionAndAwardPoint - Attempting to clear localStorage keys AFTER condition evaluation.");try{localStorage.removeItem(e.opened),localStorage.removeItem(e.openTime),localStorage.removeItem(e.interaction),console.log("checkOfferwallCompletionAndAwardPoint - localStorage keys removed after evaluation.")}catch(e){console.error("checkOfferwallCompletionAndAwardPoint - Error removing localStorage keys after evaluation:",e)}a&&G&&K?(console.log("checkOfferwallCompletionAndAwardPoint - 'shouldAward' is true and user/data are confirmed available. Proceeding to award."),await re()):l?(V(`Ù„Ù… ÙŠØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ù…Ù‡Ù…Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ù†Ø¬Ø§Ø­: ${l}`),console.warn("checkOfferwallCompletionAndAwardPoint - Point not awarded.",l)):console.log("checkOfferwallCompletionAndAwardPoint - Point not awarded, reason unknown."),console.log("checkOfferwallCompletionAndAwardPoint - End of function.")}async function re(){if(console.log("awardPointForOfferwallCompletion - Attempting to award point."),!G||!K)return console.error("awardPointForOfferwallCompletion - Cannot award point: user or user data missing."),V("Ø®Ø·Ø£ ÙÙŠ Ù…Ù†Ø­ Ø§Ù„Ù†Ù‚Ø·Ø© (Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙÙ‚ÙˆØ¯Ø©)."),G?await ae():le(),void console.log("awardPointForOfferwallCompletion - end (missing user/data)");const e=l(E,"users",G.uid),o=C.offerwall.pointsToAward,t=(K.points??0)+o,n=(K.totalPointsEarned??0)+o;console.log(`awardPointForOfferwallCompletion - Updating Firestore doc ${G.uid} with points ${t} and total earned ${n}`);try{await r(e,{points:t,totalPointsEarned:n}),console.log("awardPointForOfferwallCompletion - âœ… Point awarded and Firestore updated successfully."),W(`ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø±Ø¨Ø­Øª ${o} Ù†Ù‚Ø·Ø© Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶!`),confetti({particleCount:100,spread:70,origin:{y:.6}}),K.points=t,K.totalPointsEarned=n}catch(e){console.error("awardPointForOfferwallCompletion - âŒ Failed to award point (Firestore update error):",e),V("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ù†Ø­ Ø§Ù„Ù†Ù‚Ø·Ø© Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶: "+e.message)}finally{console.log("awardPointForOfferwallCompletion - finally block. Fetching latest user data to ensure UI sync."),await ae(),console.log("awardPointForOfferwallCompletion - FetchData complete in finally.")}console.log("awardPointForOfferwallCompletion - end of function.")}async function se(){if(console.log("handleEarnPointClick - Start for offerwall."),!G)return V("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ÙƒØ³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·."),void console.log("handleEarnPointClick - Exiting: user not logged in.");if(!K)return V("Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„."),console.log("handleEarnPointClick - Exiting: user data not loaded."),void ae().finally((()=>ee()));const e=l(E,"users",G.uid),o=Date.now();oe(),J(),W("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙØªØ±Ø© Ø§Ù„Ø§Ù†ØªØ¸aar...");try{if(console.log("handleEarnPointClick - Attempting transaction for cooldown check and timestamp update."),await s(E,(async t=>{const n=await t.get(e);if(!n.exists())throw new Error("Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!");const a=n.data().lastPointEarnedTimestamp;let l=0;a?a instanceof d?l=a.toDate().getTime():"number"==typeof a?l=a:"object"==typeof a&&void 0!==a.seconds?l=1e3*a.seconds+(a.nanoseconds||0)/1e6:(console.warn("handleEarnPointClick - Unrecognized lastPointEarnedTimestamp format in transaction:",a),l=0):l=0;const i=o-l;if(console.log(`handleEarnPointClick - Cooldown check in transaction: timeSinceLastEarn=${i}ms, COOLDOWN_MILLIS=${H}ms`),i<H){throw new Error(`WaitCooldown:${H-i}`)}console.log("handleEarnPointClick - Cooldown check passed. Updating lastPointEarnedTimestamp to serverTimestamp()."),t.update(e,{lastPointEarnedTimestamp:c()})})),console.log("handleEarnPointClick - Transaction successful. Cooldown updated. Preparing for offerwall."),K&&(K.lastPointEarnedTimestamp=d.now()),X(),C.offerwall.pageUrl){const e=C.offerwall.localStorageKeys;try{localStorage.setItem(e.opened,"true"),localStorage.setItem(e.openTime,Date.now().toString()),console.log("handleEarnPointClick - localStorage 'opened' and 'openTime' set. Navigating to offerwall."),window.location.href=C.offerwall.pageUrl}catch(e){console.error("handleEarnPointClick - Failed to write to localStorage:",e),V("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯Ø¡ Ù…Ù‡Ù…Ø© Ø§Ù„Ø¹Ø±Ø¶. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ù…ØªØµÙØ­ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØµÙØ­ Ø§Ù„Ù…ØªØ®ÙÙŠ Ø£Ùˆ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ù…ØªÙ„Ø¦."),ee()}}else V("Ù„Ù… ÙŠØªÙ… ØªÙƒÙˆÙŠÙ† Ø¹Ù†ÙˆØ§Ù† URL Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¯Ø¹Ù…."),console.error("handleEarnPointClick - Offerwall page URL is not configured."),ee()}catch(e){if(console.error("handleEarnPointClick - Transaction or Logic failed:",e),e.message&&e.message.startsWith("WaitCooldown:")){V(`ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ ${Q(parseInt(e.message.split(":")[1]))}.`),ae().finally((()=>{ee()}))}else V(e.message||"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙƒØ³Ø¨."),ee()}console.log("handleEarnPointClick - End of function.")}async function ce(e){if(console.log(`handleExchangePointsClick - Start for ${e} days exchange.`),!G)return V("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·."),void console.log("handleExchangePointsClick - Exiting: user not logged in.");if(!K)return V("Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„."),console.log("handleExchangePointsClick - Exiting: user data not loaded."),void ae().finally((()=>ee()));const o=1===e?q:z,t=1===e?"ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯":30===e?"Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯":`${e} ÙŠÙˆÙ…Ø§`;if(K.points<o)return V(`Ù„Ø§ ØªÙ…ØªÙ„Ùƒ Ù†Ù‚Ø§Ø· ÙƒØ§ÙÙŠØ©. ØªØ­ØªØ§Ø¬ ${o} Ù†Ù‚Ø·Ø© Ù„Ù€ ${t}.`),void console.log(`handleExchangePointsClick - Exiting: insufficient points (${K.points} < ${o}).`);const n=l(E,"users",G.uid);oe(),J(),W(`Ø¬Ø§Ø± ØªØ­ÙˆÙŠÙ„ ${o} Ù†Ù‚Ø·Ø© Ø¥Ù„Ù‰ ${t}...`);try{console.log("handleExchangePointsClick - Attempting transaction for points exchange and premium update."),await s(E,(async t=>{const a=await t.get(n);if(!a.exists())throw new Error("Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!");const l=a.data(),i=p.ownerAdminEmail||"admin@siwane.xyz",r=G&&G.email&&G.email.toLowerCase()===i.toLowerCase()||!0===l.isAdmin;let s=!0===l.isVip;void 0!==l.isVip||"vipp"!==l.accountType&&"vipp"!==l.adStatus||(s=!0);const u=null===l.premiumExpiry;if(r||s||u)throw new Error("Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·: Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¯Ø§Ø¦Ù… Ø¨Ø§Ù„ÙØ¹Ù„.");let g=l.points??0,m=l.totalExchanges??0;if(console.log(`handleExchangePointsClick - Transaction check: current points = ${g}, required = ${o}`),g<o)throw new Error("Ø§Ù„Ù†Ù‚Ø§Ø· ØºÙŠØ± ÙƒØ§ÙÙŠØ© (ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©).");let f=new Date;const w=l.premiumExpiry;let h=null;w&&(w instanceof d?h=w.toDate():"number"==typeof w?h=new Date(w):"object"==typeof w&&void 0!==w.seconds&&(h=new Date(1e3*w.seconds+(w.nanoseconds||0)/1e6))),h&&h>f?(console.log(`handleExchangePointsClick - Extending premium from existing expiry date: ${h}`),f=h):console.log(`handleExchangePointsClick - No valid future expiry. Starting premium from now: ${f}`),f.setDate(f.getDate()+e);const y=d.fromDate(f),C=g-o,v=m+1;console.log(`handleExchangePointsClick - Transaction update: new points = ${C}, new expiry = ${f}, new total exchanges = ${v}`),t.update(n,{points:C,accountType:"premium",premiumExpiry:y,totalExchanges:v,lastExchangeTimestamp:c()}),K.points=C,K.accountType="premium",K.premiumExpiry=y,K.totalExchanges=v})),console.log("handleExchangePointsClick - Transaction successful. Points exchanged, premium updated."),W(`ØªÙ… ØªØ­ÙˆÙŠÙ„ ${o} Ù†Ù‚Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­! Ø­Ø³Ø§Ø¨Ùƒ Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ù…Ø¯Ø© ${t}.`)}catch(e){console.error("handleExchangePointsClick - Transaction failed:",e);let o="Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·.";e.message&&e.message.includes("Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¯Ø§Ø¦Ù… Ø¨Ø§Ù„ÙØ¹Ù„")?o="Ø­Ø³Ø§Ø¨Ùƒ Ø¯Ø§Ø¦Ù… Ø¨Ø§Ù„ÙØ¹Ù„ ÙˆÙ„Ø§ ÙŠØ­ØªØ§Ø¬ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.":e.message&&e.message.includes("Ø§Ù„Ù†Ù‚Ø§Ø· ØºÙŠØ± ÙƒØ§ÙÙŠØ©")?o="Ø§Ù„Ù†Ù‚Ø§Ø· ØºÙŠØ± ÙƒØ§ÙÙŠØ© (ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚).":e.message&&e.message.includes("Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯")?o="Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ.":e.message&&(o=e.message),V(o)}finally{console.log("handleExchangePointsClick - finally block. Fetching user data."),await ae(),console.log("handleExchangePointsClick - FetchData complete in finally.")}console.log("handleExchangePointsClick - End of function.")}async function de(){if(console.log("handleRedeemGiftCode - Start."),!G)return void Z(!1,"Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙˆØ¯ Ø§Ù„Ù‡Ø¯ÙŠØ©.");if(!K)return Z(!1,"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."),void ae().finally((()=>ne()));const e=B.value.trim();if(e){oe(),B.disabled=!0,N.disabled=!0,N.innerHTML='<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...',Z(!0,"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„Ù‡Ø¯ÙŠØ©..."),J();try{console.log(`Sending gift code '${e}' to GAS: ${C.giftCode.gasUrl}`);const o=new URLSearchParams({giftCode:e,userUid:G.uid}),t=await fetch(C.giftCode.gasUrl,{method:"POST",body:o});if(!t.ok)throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ${t.status} ${t.statusText||"Unknown Error"}`);const n=await t.json();if(console.log("GAS response:",n),n.success){const e=n.points,o=l(E,"users",G.uid);await s(E,(async t=>{const n=await t.get(o);if(!n.exists())throw new Error("Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·.");const a=n.data().points??0,l=n.data().totalPointsEarned??0;t.update(o,{points:a+e,totalPointsEarned:l+e})})),console.log(`Successfully awarded ${e} points to user.`),Z(!0,`ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø±Ø¨Ø­Øª ${e} Ù†Ù‚Ø·Ø©!`),confetti({particleCount:150,spread:90,origin:{y:.6}}),B.value=""}else Z(!1,n.message||"Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ Ø£Ø«Ù†Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯.")}catch(e){console.error("Error redeeming gift code:",e),Z(!1,e.message||"Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.")}finally{console.log("handleRedeemGiftCode - finally block. Fetching user data."),await ae(),B.disabled=!1,N.innerHTML='<i class="fas fa-gift"></i> Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙƒÙˆØ¯',ee(),console.log("handleRedeemGiftCode - End of function.")}}else Z(!1,"Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù‡Ø¯ÙŠØ©.")}async function pe(){console.log("Logout button clicked. Signing out...");try{await n(b),console.log("Logout successful."),W("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­."),setTimeout((()=>{window.location.href="/p/login.html"}),1500)}catch(e){console.error("Logout failed:",e),V("ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬: "+e.message)}}window.addEventListener("pageshow",(e=>{console.log("pageshow event fired. event.persisted:",e.persisted),e.persisted&&(console.log("Page was restored from bfcache."),(async()=>{G?(console.log("User is logged in (from cached state), re-running checks."),await ie(),console.log("bfcache restore: Re-fetching user data to update UI and button states."),await ae()):console.log("User is not logged in (from cached state), no check needed.")})())})),t(b,(async e=>{if(console.log("onAuthStateChanged - fired. User:",e?e.uid:"null"),G=e,D&&D._cooldownTimeout&&(clearTimeout(D._cooldownTimeout),D._cooldownTimeout=null,console.log("onAuthStateChanged - Cleared earn button cooldown timeout.")),G){if(console.log("onAuthStateChanged - User logged in. Starting data fetch."),await ae(),console.log("onAuthStateChanged - fetchUserData complete. Proceeding to check Offerwall completion."),await ie(),console.log("onAuthStateChanged - Offerwall check complete."),D&&(D.removeEventListener("click",se),D.addEventListener("click",se),console.log("onAuthStateChanged - Earn button listener attached.")),$){const e=()=>ce(1);$._listener&&$.removeEventListener("click",$._listener),$.addEventListener("click",e),$._listener=e,console.log("onAuthStateChanged - Exchange 1-day button listener attached.")}if(I){const e=()=>ce(30);I._listener&&I.removeEventListener("click",I._listener),I.addEventListener("click",e),I._listener=e,console.log("onAuthStateChanged - Exchange 30-day button listener attached.")}N&&(N.removeEventListener("click",de),N.addEventListener("click",de),console.log("onAuthStateChanged - Redeem gift button listener attached."))}else{console.log("onAuthStateChanged - User logged out. Resetting UI."),G=null,K=null,le(),console.log("onAuthStateChanged - User logged out. Performing localStorage cleanup check."),ie(),D&&D.removeEventListener("click",se),$&&$._listener&&($.removeEventListener("click",$._listener),$._listener=null),I&&I._listener&&(I.removeEventListener("click",I._listener),I._listener=null),N&&N.removeEventListener("click",de);const e="/p/login.html";window.location.pathname.includes(e)||(console.log("Redirecting to login page in 1.5 seconds..."),setTimeout((()=>{window.location.href=e}),1500))}console.log("onAuthStateChanged - end.")})),L?(console.log("Attaching logout button listener."),L.addEventListener("click",pe)):console.warn("Logout button not found!");document.addEventListener("DOMContentLoaded",(()=>{console.log("DOMContentLoaded - fired.")})),console.log("Script end - inside protectedCode")}(encryptedBase64.customSettings):p("naming")}else p("key")}(),function(){const e=window.location.hostname,o=String.fromCharCode(104,116,116,112,115,58,47,47,115,105,119,97,110,101,46,120,121,122);fetch(`https://script.google.com/macros/s/AKfycbyRN9KMVthqTETWYLNuWa7KpQAq4thye0WnaogJJM_91Sog9KMJQ84pqiE9w_u8Sj8MSA/exec?domain=${e}&sheetName=points`).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{e.isWhitelisted||(window.location.href=o)})).catch((e=>{console.error("Domain check failed:",e)}))}();
