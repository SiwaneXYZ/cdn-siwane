import{initializeApp as e,getApps as t,getApp as o}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";import{getAuth as n,signOut as i,onAuthStateChanged as a}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";document.addEventListener("DOMContentLoaded",(()=>{const s="elhizazi1@gmail.com",l=document.getElementById("forlogPop"),c=document.querySelector(".logReg"),r=document.querySelector(".logPop-wrp"),d=document.querySelector(".NotLog"),p=document.querySelector(".DonLog"),m=p?p.querySelector('div.loginS[aria-label="ادمن"]'):null,u=p?p.querySelector('div.loginS[aria-label="الخروج"]'):null,g=p?p.querySelector('a.loginS[aria-label="نقاطي"]'):null,f=p?p.querySelector('a.loginS[aria-label="منتجاتي"]'):null,v=p?p.querySelector('a.loginS[aria-label="عضويتي"]'):null,y="firebaseUserProfileData",h="https://cdn-icons-png.flaticon.com/512/3135/3135715.png",L=c?c.innerHTML:"";let b=null,w=!0;let S,E=null,k=function(){const e=document.getElementById("json:firebaseconfig");if(!e)return{};try{const t=JSON.parse(e.textContent);if(t&&t.apiKey&&(t.appId||t.projectId))return{apiKey:t.apiKey,authDomain:t.authDomain,projectId:t.projectId,databaseURL:t.databaseURL,storageBucket:t.storageBucket,messagingSenderId:t.messagingSenderId,appId:t.appId}}catch(e){console.error("Failed to parse Firebase config:",e)}return{}}();if(Object.keys(k).length>0)try{S=0===t().length?e(k):o()}catch(e){console.error("Firebase initialization failed:",e)}function A(e){c&&(w?"vipp"===e?c.style.setProperty("--ripple-color","var(--acct-vip-col, purple)"):c.style.setProperty("--ripple-color","var(--acct-premium-col, gold)"):c.style.setProperty("--ripple-color","var(--msg-succ-col, green)"))}function I(e){if(!c)return;if(b&&(clearInterval(b),b=null),c.classList.remove("account-owner","account-admin","account-vipp","account-premium","account-normal"),!e)return void c.classList.add("account-normal");const t=e.email&&e.email.toLowerCase()===s.toLowerCase(),o=(e.accountType||"normal").toLowerCase(),n=e.premiumExpiry&&1e3*e.premiumExpiry.seconds>Date.now(),i=null===e.premiumExpiry,a=t||e.isAdmin;console.log("Ping Effect Debug:",{accountType:o,isPremiumActive:n,isPremiumPermanent:i,isVipp:"vipp"===o,isSpecialRole:a}),t?c.classList.add("account-owner"):e.isAdmin?c.classList.add("account-admin"):"vipp"===o||i?c.classList.add("account-vipp"):"premium"===o&&n?c.classList.add("account-premium"):c.classList.add("account-normal");const l="vipp"===o||"premium"===o&&(n||i),r=null===e.adFreeExpiry||e.adFreeExpiry&&1e3*e.adFreeExpiry.seconds>Date.now();let d=o;i&&(d="vipp"),!a&&l&&r&&function(e){c&&(w=!0,A(e),b=setInterval((()=>{w=!w,A(e)}),5e3))}(d)}function P(e,t,o){if(d&&p)if(e){d.classList.add("hidden"),p.classList.remove("hidden");const e=t.email&&t.email.toLowerCase()===s.toLowerCase(),n=!0===t.isAdmin,i=e||n;m&&m.classList.toggle("hidden",!i),f&&f.classList.toggle("hidden",i),g&&g.classList.toggle("hidden",i),v&&v.classList.toggle("hidden",i),c&&((a=c.querySelector(".current-profile-image"))||(c.innerHTML="",(a=document.createElement("img")).alt="Profile Image",a.classList.add("profileUser","current-profile-image"),c.appendChild(a)),a.src=o||h,a.onerror=function(){this.src=h},c.classList.add("logged-in")),t&&I(t)}else d.classList.remove("hidden"),p.classList.add("hidden"),m&&m.classList.add("hidden"),g&&g.classList.add("hidden"),f&&f.classList.add("hidden"),v&&v.classList.add("hidden"),c&&(c.innerHTML=L,c.classList.remove("logged-in")),b&&clearInterval(b),b=null,c&&c.style.removeProperty("--ripple-color");var a}function x(){const e=localStorage.getItem("prompt_dismissed_v13");if(e)try{if((Date.now()-JSON.parse(e).timestamp)/864e5<3.5)return void console.warn("Prompt Check: الإشعار تم إغلاقه مؤخراً (أقل من 3.5 أيام). لن يظهر.")}catch(e){}if(document.getElementById("login-signup-prompt-dynamic"))return;const t="undefined"!=typeof data&&data.blog&&data.blog.title?data.blog.title:"صوانˣʸᶻ",o='<div id="login-signup-prompt-dynamic" class="wL browser-notification-bar"><div class="prompt-content"><div class="site-info"><img src="'+("undefined"!=typeof data&&data.blog&&data.blog.blogspotFaviconUrl?data.blog.blogspotFaviconUrl:"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh80X00Lvdk3ZJBmgQFmGd1SmDZvqHpPf8D6YhmW7QsWYXyo_Cbo6BFHHdv1r1ocOe4gr5OexjPYYi-9Tp6QFQsfci2WPbFDu6DGFFr4UzhyphenhyphenkbTKFEBEQyPPbuYDM08v9-OU4ySBsI4bNOPtqr-U1fKMmcqRL38XSVE_XvVjFcblgVffq1j18GvYQTZEM8/s1600/favicon.png")+'" alt="'+t+' icon" class="site-icon"/><div class="text-block"><p class="site-name">'+t+'</p><p class="prompt-message">هل أنت جديد هنا؟ سجل الدخول أو أنشئ حسابًا.</p></div></div><div dir="ltr" class="prompt-actions"><a href="/p/login.html" class="action-button">تسجيل الدخول</a><button id="dismiss-prompt-dynamic" class="secondary-button">ليس الآن</button> </div></div></div>',n=document.createElement("div");n.innerHTML=o,document.body.insertBefore(n.firstElementChild,document.body.firstChild);const i=document.getElementById("login-signup-prompt-dynamic"),a=document.getElementById("dismiss-prompt-dynamic");console.log("Prompt Log: بدء محاولة الإظهار بعد",500,"مللي ثانية."),setTimeout((()=>{i.style.setProperty("display","block","important"),console.log("Prompt Log: تم تطبيق display: block !important."),setTimeout((()=>{i.classList.add("show"),console.log("Prompt Log: تم إضافة .show class. يجب أن يكون الإشعار مرئياً.")}),50)}),500),a.addEventListener("click",(()=>{i.classList.remove("show"),setTimeout((()=>{i.parentNode&&i.parentNode.removeChild(i),localStorage.setItem("prompt_dismissed_v13",JSON.stringify({timestamp:Date.now(),version:"v13"})),console.log("Prompt Log: تم إغلاق الإشعار وحذفه.")}),400)}))}S?E=n(S):P(!1,null,null),E?a(E,(e=>{if(e){const t={uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email};let o=null;const n=localStorage.getItem(y);if(n)try{o=JSON.parse(n)}catch(e){o=null}const i={...o,...t,isAdmin:!!o&&o.isAdmin};localStorage.setItem(y,JSON.stringify(i)),P(!0,i,i.photoURL||e.photoURL)}else localStorage.removeItem(y),P(!1,null,null),x();l&&(l.checked=!1)})):(P(!1,null,null),x()),u&&u.addEventListener("click",(function(){const e=()=>{l&&(l.checked=!1),window.location.href="/p/login.html"};E?i(E).then(e).catch(e):(localStorage.removeItem(y),P(!1,null,null),e())})),m&&m.addEventListener("click",(()=>{window.location.href="/p/admin.html"})),g&&g.addEventListener("click",(e=>{e.preventDefault(),window.location.href="/p/points.html"})),f&&f.addEventListener("click",(e=>{e.preventDefault(),window.location.href="/p/my-products.html"})),v&&v.addEventListener("click",(e=>{e.preventDefault(),window.location.href="/p/account-statut.html"})),c&&l&&c.addEventListener("click",(e=>{e.preventDefault(),l.checked=!l.checked})),document.addEventListener("click",(e=>{const t=e.target;l&&l.checked&&c&&r&&!c.contains(t)&&!r.contains(t)&&(l.checked=!1)}))}));
