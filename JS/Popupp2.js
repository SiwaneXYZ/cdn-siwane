import{initializeApp as e,getApps as t,getApp as o}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";import{getAuth as n,signOut as i,onAuthStateChanged as a}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";document.addEventListener("DOMContentLoaded",(()=>{const s=document.getElementById("forlogPop"),l=document.querySelector(".logReg"),c=document.querySelector(".logPop-wrp"),r=document.querySelector(".NotLog"),d=document.querySelector(".DonLog"),p=d?d.querySelector('div.loginS[aria-label="ادمن"]'):null,m=d?d.querySelector('div.loginS[aria-label="الخروج"]'):null,u=d?d.querySelector('a.loginS[aria-label="نقاطي"]'):null,g=d?d.querySelector('a.loginS[aria-label="منتجاتي"]'):null,f="firebaseUserProfileData",v="https://cdn-icons-png.flaticon.com/512/3135/3135715.png",y=l?l.innerHTML:"";let h=null,L=!0;let b,w=null,S=function(){const e=document.getElementById("json:firebaseconfig");if(!e)return{};try{const t=JSON.parse(e.textContent);if(t&&t.apiKey&&(t.appId||t.projectId))return{apiKey:t.apiKey,authDomain:t.authDomain,projectId:t.projectId,databaseURL:t.databaseURL,storageBucket:t.storageBucket,messagingSenderId:t.messagingSenderId,appId:t.appId}}catch(e){console.error("Failed to parse Firebase config:",e)}return{}}();if(Object.keys(S).length>0)try{b=0===t().length?e(S):o()}catch(s){console.error("Firebase initialization failed:",s)}function E(e){l&&(L?"vipp"===e?l.style.setProperty("--ripple-color","var(--acct-vip-col, purple)"):l.style.setProperty("--ripple-color","var(--acct-premium-col, gold)"):l.style.setProperty("--ripple-color","var(--msg-succ-col, green)"))}function I(e){if(!l)return;if(h&&(clearInterval(h),h=null),l.classList.remove("account-owner","account-admin","account-vipp","account-premium","account-normal"),!e)return void l.classList.add("account-normal");const t=e.email&&window.ownerAdminEmail&&e.email.toLowerCase()===window.ownerAdminEmail.toLowerCase(),o=(e.accountType||"normal").toLowerCase(),n=e.premiumExpiry&&1e3*e.premiumExpiry.seconds>Date.now(),p=null===e.premiumExpiry,i=t||e.isAdmin;console.log("Ping Effect Debug:",{accountType:o,isPremiumActive:n,isPremiumPermanent:p,isVipp:"vipp"===o,isSpecialRole:i}),t?l.classList.add("account-owner"):e.isAdmin?l.classList.add("account-admin"):"vipp"===o||p?l.classList.add("account-vipp"):"premium"===o&&n?l.classList.add("account-premium"):l.classList.add("account-normal");const a="vipp"===o||"premium"===o&&(n||p),s=null===e.adFreeExpiry||e.adFreeExpiry&&1e3*e.adFreeExpiry.seconds>Date.now();let c=o;p&&(c="vipp"),!i&&a&&s&&function(e){l&&(L=!0,E(e),h=setInterval((()=>{L=!L,E(e)}),5e3))}(c)}function k(e,t,o){if(r&&d)if(e){r.classList.add("hidden"),d.classList.remove("hidden");const e=!0===t.isAdmin;p&&p.classList.toggle("hidden",!e),g&&g.classList.toggle("hidden",e),u&&u.classList.toggle("hidden",e),l&&((n=l.querySelector(".current-profile-image"))||(l.innerHTML="",(n=document.createElement("img")).alt="Profile Image",n.classList.add("profileUser","current-profile-image"),l.appendChild(n)),n.src=o||v,n.onerror=function(){this.src=v},l.classList.add("logged-in")),t&&I(t)}else r.classList.remove("hidden"),d.classList.add("hidden"),p&&p.classList.add("hidden"),u&&u.classList.add("hidden"),g&&g.classList.add("hidden"),l&&(l.innerHTML=y,l.classList.remove("logged-in")),h&&clearInterval(h),h=null,l&&l.style.removeProperty("--ripple-color");var n}function P(){const e=localStorage.getItem("prompt_dismissed_v13");if(e)try{if((Date.now()-JSON.parse(e).timestamp)/864e5<3.5)return void console.warn("Prompt Check: الإشعار تم إغلاقه مؤخراً (أقل من 3.5 أيام). لن يظهر.")}catch(e){}if(document.getElementById("login-signup-prompt-dynamic"))return;const t="undefined"!=typeof data&&data.blog&&data.blog.title?data.blog.title:"صوانˣʸᶻ",o=`<div id="login-signup-prompt-dynamic" class="browser-notification-bar">\n                <div class="prompt-content">\n                    <div class="site-info">\n                        <img src="${"undefined"!=typeof data&&data.blog&&data.blog.blogspotFaviconUrl?data.blog.blogspotFaviconUrl:"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh80X00Lvdk3ZJBmgQFmGd1SmDZvqHpPf8D6YhmW7QsWYXyo_Cbo6BFHHdv1r1ocOe4gr5OexjPYYi-9Tp6QFQsfci2WPbFDu6DGFFr4UzhyphenhyphenkbTKFEBEQyPPbuYDM08v9-OU4ySBsI4bNOPtqr-U1fKMmcqRL38XSVE_XvVjFcblgVffq1j18GvYQTZEM8/s1600/favicon.png"}" alt="${t} icon" class="site-icon"/>\n                        <div class="text-block">\n                            <p class="site-name">${t}</p>\n                            <p class="prompt-message">هل أنت جديد هنا؟ سجل الدخول أو أنشئ حسابًا.</p>\n                        </div>\n                    </div>\n                    <div dir="ltr" class="prompt-actions">\n                        <a href="/p/login.html" class="action-button">تسجيل الدخول</a>\n                        <button id="dismiss-prompt-dynamic" class="secondary-button">ليس الآن</button> \n                    </div>\n                </div>\n            </div>`,n=document.createElement("div");n.innerHTML=o,document.body.insertBefore(n.firstElementChild,document.body.firstChild);const i=document.getElementById("login-signup-prompt-dynamic"),a=document.getElementById("dismiss-prompt-dynamic");console.log("Prompt Log: بدء محاولة الإظهار بعد",500,"مللي ثانية."),setTimeout((()=>{i.style.setProperty("display","block","important"),console.log("Prompt Log: تم تطبيق display: block !important."),setTimeout((()=>{i.classList.add("show"),console.log("Prompt Log: تم إضافة .show class. يجب أن يكون الإشعار مرئياً.")}),50)}),500),a.addEventListener("click",(()=>{i.classList.remove("show"),setTimeout((()=>{i.parentNode&&i.parentNode.removeChild(i),localStorage.setItem("prompt_dismissed_v13",JSON.stringify({timestamp:Date.now(),version:"v13"})),console.log("Prompt Log: تم إغلاق الإشعار وحذفه.")}),400)}))}b?w=n(b):k(!1,null,null),w?a(w,(e=>{if(e){const t={uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email};let o=null;const n=localStorage.getItem(f);if(n)try{o=JSON.parse(n)}catch(e){o=null}const i={...o,...t,isAdmin:!!o&&o.isAdmin};localStorage.setItem(f,JSON.stringify(i)),k(!0,i,i.photoURL||e.photoURL)}else localStorage.removeItem(f),k(!1,null,null),P();s&&(s.checked=!1)})):(k(!1,null,null),P()),m&&m.addEventListener("click",(function(){const e=()=>{s&&(s.checked=!1),window.location.href="/p/login.html"};w?i(w).then(e).catch(e):(localStorage.removeItem(f),k(!1,null,null),e())})),p&&p.addEventListener("click",(()=>{window.location.href="/p/admin.html"})),u&&u.addEventListener("click",(e=>{e.preventDefault(),window.location.href="/p/points.html"})),g&&g.addEventListener("click",(e=>{e.preventDefault(),window.location.href="/p/my-products.html"})),l&&s&&l.addEventListener("click",(e=>{e.preventDefault(),s.checked=!s.checked})),document.addEventListener("click",(e=>{const t=e.target;s&&s.checked&&l&&c&&!l.contains(t)&&!c.contains(t)&&(s.checked=!1)}))}));
