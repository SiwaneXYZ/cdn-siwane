const F_PK='firebaseUserProfileData',D_PI='https://cdn-icons-png.flaticon.com/512/3135/3135715.png',F_SV='11.6.1';let a=null,b=null,c='',d=!1,e,f,g,h,i,j,k,l;function m(){const m=document.getElementById("json:firebaseconfig");if(!m)return null;try{const n=JSON.parse(m.textContent);if(n&&n.apiKey&&(n.appId||n.projectId))return{apiKey:n.apiKey,authDomain:n.authDomain,projectId:n.projectId,databaseURL:n.databaseURL,storageBucket:n.storageBucket,messagingSenderId:n.messagingSenderId,appId:n.appId}}catch(n){console.error("Failed to parse Firebase config:",n)}return null}async function n(){if(d)return;const m=m();if(!m)return console.warn("Firebase config is missing or invalid. Auth features skipped."),r(!1,null,null),s(),void(e&&(e.checked=!1));try{const n=await import(`https://www.gstatic.com/firebasejs/${F_SV}/firebase-app.js`),o=await import(`https://www.gstatic.com/firebasejs/${F_SV}/firebase-auth.js`);const{initializeApp:p,getApps:q,getApp:r}=n,{getAuth:t,onAuthStateChanged:u,signOut:v}=o;const w=q();0===w.length?b=p(m):b=r();a=t(b),d=!0,u(a,w=>{w?o(w):p(),e&&(e.checked=!1)}),l&&(l.removeEventListener("click",w),l.addEventListener("click",()=>w(a,v)))}catch(n){console.error("Firebase initialization or dynamic import failed:",n),r(!1,null,null),s(),e&&(e.checked=!1)}}function o(m){console.log("User is logged in:",m.uid);const n={uid:m.uid,displayName:m.displayName,photoURL:m.photoURL,email:m.email};let o=null;try{const p=localStorage.getItem(F_PK);o=p?JSON.parse(p):null}catch(m){console.error("Failed to parse cached user data:",m)}const p={...o,...n,isAdmin:o?o.isAdmin:!1};localStorage.setItem(F_PK,JSON.stringify(p)),r(!0,p,p.photoURL||m.photoURL)}function p(){console.log("User is logged out."),localStorage.removeItem(F_PK),r(!1,null,null),s()}function q(m){const n=()=>{console.log("Performing post-logout cleanup."),e&&(e.checked=!1),window.location.href="/p/login.html"};if(!a)return console.warn("Firebase Auth not available. Cannot perform Firebase signOut."),localStorage.removeItem(F_PK),r(!1,null,null),void n();m(a).then(()=>{console.log("Firebase signOut successful."),n()}).catch(o=>{console.error("Logout failed:",o),n()})}function r(m,n,o){if(!h||!i)return;if(m){h.classList.add("hidden"),i.classList.remove("hidden");const d=n&&!0===n.isAdmin;j&&j.classList.toggle("hidden",!d),k&&k.classList.toggle("hidden",d),l&&l.classList.toggle("hidden",d),f&&(function(m,n,o){let d=m.querySelector(".current-profile-image");const e=n||D_PI;if(!d){m.innerHTML="",d=document.createElement("img"),d.alt="Profile Image",d.classList.add("profileUser","current-profile-image"),m.appendChild(d),d.onerror=function(){this.src=D_PI}}d.src=e,m.classList.add("logged-in")})(f,o)}else{h.classList.remove("hidden"),i.classList.add("hidden"),j&&j.classList.add("hidden"),k&&k.classList.add("hidden"),l&&l.classList.add("hidden"),f&&(f.innerHTML=c,f.classList.remove("logged-in"))}}function s(){const m=localStorage.getItem("prompt_dismissed_v13");const n=Date.now();if(m){try{const o=JSON.parse(m);const p=(n-o.timestamp)/(1e3*60*60*24);if(p<3.5)return}catch(m){console.error("Error parsing prompt dismissal data:",m)}}const o="undefined"!=typeof data&&data.blog?.title?data.blog.title:"صوانˣʸᶻ",p="undefined"!=typeof data&&data.blog?.blogspotFaviconUrl?data.blog.blogspotFaviconUrl:"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh80X00Lvdk3ZJBmgQFmGd1SmDZvqHpPf8D6YhmW7QsWYXyo_Cbo6BFHHdv1r1ocOe4gr5OexjPYYi-9Tp6QFQsfci2WPbFDu6DGFFr4UzhyphenhyphenkbTKFEBEQyPPbuYDM08v9-OU4ySBsI4bNOPtqr-U1fKMmcqRL38XSVE_XvVjFcblgVffq1j18GvYQTZEM8/s1600/favicon.png";const q=`
        <div id="login-signup-prompt-dynamic" class="browser-notification-bar">
            <div class="prompt-content">
                <div class="site-info">
                    <img src="${p}" alt="${o} icon" class="site-icon"/>
                    <div class="text-block">
                        <p class="site-name">${o}</p>
                        <p class="prompt-message">هل أنت جديد هنا؟ سجل الدخول أو أنشئ حسابًا.</p>
                    </div>
                </div>
                <div dir="ltr" class="prompt-actions">
                    <a href="/p/login.html" class="action-button">تسجيل الدخول</a>
                    <button id="dismiss-prompt-dynamic" class="secondary-button">ليس الآن</button> 
                </div>
            </div>
        </div>
    `;let r=document.getElementById("login-signup-prompt-dynamic");if(!r){const t=document.createElement("div");t.innerHTML=q.trim(),r=t.firstElementChild,document.body.appendChild(r)}const u=document.getElementById("dismiss-prompt-dynamic");const v=5e3,w=400;setTimeout(()=>{r.style.display="block",setTimeout(()=>{r.classList.add("show")},50)},v),u.addEventListener("click",()=>{r.classList.remove("show"),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},w);const m={timestamp:n,version:"v13"};localStorage.setItem("prompt_dismissed_v13",JSON.stringify(m))},{once:!0})}document.addEventListener("DOMContentLoaded",()=>{e=document.getElementById("forlogPop"),f=document.querySelector(".logReg"),g=document.querySelector(".logPop-wrp"),h=document.querySelector(".NotLog"),i=document.querySelector(".DonLog"),i&&(j=i.querySelector('div.loginS[aria-label="ادمن"]'),k=i.querySelector('a.loginS[aria-label="نقاطي"]'),l=i.querySelector('div.loginS[aria-label="الخروج"]'),myProductsElement=i.querySelector('a.loginS[aria-label="منتجاتي"]')),c=f?f.innerHTML:"",j&&j.addEventListener("click",()=>window.location.href="/p/admin.html"),k&&k.addEventListener("click",m=>{m.preventDefault(),window.location.href="/p/points.html"}),myProductsElement&&myProductsElement.addEventListener("click",m=>{m.preventDefault(),window.location.href="/p/my-products.html"}),f&&e&&f.addEventListener("click",m=>{m.preventDefault(),e.checked=!e.checked}),document.addEventListener("click",m=>{const n=m.target;e&&e.checked&&f&&g&&!f.contains(n)&&!g.contains(n)&&(e.checked=!1)}),n()});
